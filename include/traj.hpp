#include <math.h>
#include <iostream>
#include <fstream>
#include <filesystem>

#include <mujoco/mujoco.h>

#include <config.hpp>

struct {
    // this is used to signal that a new trajectory has been loaded, true when a new trajectory is loaded, false otherwise
    bool new_traj = true; 
    // in some experiments the trajectory following may start at a different position, 
    // therefore we first need to make sure that the robot is at the correct position before starting the trajectory, 
    // this variable makes sure that the time goals for the trajectory aligns
    double traj_start_time;
    // traj index must start from 1, otherwise calculate_goal will give incorrect results. 
    int traj_index = 1;
    bool went_to_init = false;
    
    // This is tolerance for the joint space
    const double GOAL_TOLERANCE = 0.1;
    const double EXP_HARD_STOP_TIME = 40.0;
} TrajectoryVars;


double position_array[][6] = {
{-2.2681189875972954, -1.7248420637073125, 0.2983396339315189, -1.9868980548040653, 1.0451446818771761, 0.39756637259648786},
{-2.2601167167424037, -1.7200033037054967, 0.29933680624916126, -2.0018179039690844, 1.0066483666868073, 0.409473164044376},
{-2.2516481586170474, -1.7146481836035035, 0.30037649175890074, -2.016784132804462, 0.9694641654114577, 0.422402765215919},
{-2.2428803795455337, -1.7088121991263636, 0.30130182480585754, -2.0317451106606645, 0.9335980488511235, 0.4361693317864726},
{-2.233953222395998, -1.7025239005181152, 0.3019885869356586, -2.0466472321248226, 0.8990212731340425, 0.45061700161434687},
{-2.2249808604483405, -1.6958057920277927, 0.3023411659660051, -2.061437970269342, 0.8656828757780858, 0.4656174613736934},
{-2.2160548840262253, -1.6886753119259803, 0.3022878892514087, -2.076067615195751, 0.8335190470845263, 0.48106628055301687},
{-2.2072478333249417, -1.6811457369497316, 0.30177652039403974, -2.0904900923748526, 0.8024597631959701, 0.4968789798600535},
{-2.198616596491752, -1.6732269619335312, 0.3007703096747181, -2.1046632040692606, 0.7724332747468708, 0.5129873558093035},
{-2.1902054101234274, -1.6649261466531995, 0.2992447156126789, -2.1185485372821193, 0.7433690215360756, 0.5293362810849387},
{-2.182048381856962, -1.6562482412512725, 0.2971847751242852, -2.1321111981783685, 0.7151994408205562, 0.5458810317670747},
{-2.1741715477215795, -1.64719640863836, 0.2945830400806913, -2.145319472094094, 0.687861022196609, 0.5625851098858015},
{-2.1665945171433005, -1.637772363073052, 0.2914379816587639, -2.158144467240031, 0.6612948625034736, 0.5794184964808443},
{-2.1593317704968573, -1.6279766422967683, 0.28775276804839156, -2.170559774010107, 0.6354468968847791, 0.5963562628109761},
{-2.152393672368565, -1.6178088279083744, 0.2835343334468782, -2.1825411557216925, 0.6102679255195742, 0.6133774718518898},
{-2.145787256266615, -1.6072677259416144, 0.2787926705868755, -2.194066277075626, 0.5857135154544681, 0.6304643113101136},
{-2.1395168275651173, -1.596351517250244, 0.2735402924142117, -2.2051144712382933, 0.5617438293774248, 0.647601409406085},
{-2.1335844228503213, -1.5850578853337551, 0.26779182001332824, -2.2156665435431506, 0.5383234143619842, 0.6647752939662865},
{-2.1279901563648247, -1.5733841276653058, 0.2615636632480103, -2.2257046084027947, 0.5154209710108818, 0.6819739633291295},
{-2.1227324780956764, -1.561327255333895, 0.25487376805900763, -2.235211955471616, 0.49300911507322587, 0.69918654411916},
{-2.11780836315341, -1.5488840848120926, 0.24774141025569588, -2.244172941024135, 0.4710641381548086, 0.7164030162122589},
{-2.1132134482820315, -1.5360513248542353, 0.24018702026606079, -2.252572900701398, 0.4495657707001327, 0.7336139894175512},
{-2.1089421284067624, -1.522825660842843, 0.23223202698083892, -2.2603980800806425, 0.42849694831583607, 0.7508105197426517},
{-2.104987623865659, -1.5092038382836672, 0.2238987117838006, -2.267635579867928, 0.40784358129215315, 0.767983955775699},
{-2.101342027268372, -1.495182746611544, 0.21521006623183786, -2.274273312893231, 0.3875943266892187, 0.7851258078951024},
{-2.0979963375743234, -1.4807595039343164, 0.20618964884016835, -2.2802999704381315, 0.3677403622359316, 0.8022276347952095},
{-2.0949404878787212, -1.4659315428169009, 0.19686143811130108, -2.2857049957552396, 0.34827516144956244, 0.8192809432948615},
{-2.092163372499517, -1.4506966967294996, 0.18724968033934267, -2.290478562969773, 0.32919426983190225, 0.8362770986695395},
{-2.089652878102353, -1.4350532862850889, 0.1773787319534317, -2.2946115598270174, 0.3104950824355466, 0.8532072438011036},
{-2.087395922795485, -1.4190002039435172, 0.16727289718254218, -2.2980955730103494, 0.2921766236258126, 0.8700622263388501},
{-2.085378506342241, -1.4025369954768918, 0.15695626264365165, -2.3009228749954342, 0.27423933042417215, 0.8868325338188112},
{-2.083585773778618, -1.3856639361437084, 0.14645253113524453, -2.303086411587309, 0.25668484120284624, 0.9035082372485067},
{-2.082002093883884, -1.3683820993007323, 0.13578485736884696, -2.3045797894617577, 0.23951579188900093, 0.9200789440901364},
{-2.0806111530791354, -1.350693415062872, 0.12497568864779449, -2.3053972631624604, 0.22273562205607464, 0.9365337618199211},
{-2.0793960644465943, -1.332600716620345, 0.11404661360090987, -2.305533721094229, 0.20634839331351318, 0.9528612733018131},
{-2.078339490749034, -1.3141077719720506, 0.10301822197872296, -2.3049846701211325, 0.1903586223336256, 0.9690495251205733},
{-2.077423779579686, -1.295219299118785, 0.09190997824636547, -2.303746218423399, 0.17477113065032815, 0.9850860297833745},
{-2.0766311081196003, -1.2759409631443541, 0.08074011132214963, -2.3018150562694335, 0.15959091293940636, 1.0009577822984137},
{-2.0759436345034725, -1.2562793541230632, 0.06952552228206307, -2.2991884343673648, 0.14482302505415845, 1.016651291171691},
{-2.075343652467388, -1.2362419453693143, 0.058281711246203904, -2.295864139457558, 0.13047249257520488, 1.0321526233343001},
{-2.0748137458147156, -1.2158370321421892, 0.047022724055247885, -2.2918404667844654, 0.1165442400033729, 1.0474474619277332},
{-2.0743369392972877, -1.1950736515469333, 0.0357611186860408, -2.2871161890985605, 0.10304304024816642, 1.0625211753675492},
{-2.073896842734023, -1.17396148493572, 0.024507950787510873, -2.281690521830138, 0.08997348348999752, 1.0773588956016629},
{-2.0734777855821025, -1.1525107446265264, 0.013272777174664248, -2.2755630841051984, 0.07733996412122812, 1.0919456031132988},
{-2.0730649396874807, -1.1307320471593705, 0.0020636756994127092, -2.268733855297055, 0.06514668411126963, 1.1062662159322367},
{-2.072644428537864, -1.1086362756073707, -0.009112720426149233, -2.26120312685656, 0.05339767097366577, 1.1203056797864606},
{-2.072203422011232, -1.086234433603978, -0.02025117594165411, -2.2529714491947024, 0.04209680831059651, 1.1340490564663261},
{-2.071730216238694, -1.0635374938147126, -0.03134779675742079, -2.2440395734766456, 0.03124787712231344, 1.1474816076424115},
{-2.0712142988912148, -1.0405562434489135, -0.042399965230855555, -2.234408388193352, 0.020854605926996533, 1.1605888714872974},
{-2.0706464007382617, -1.0173011292485084, -0.053406269657972384, -2.2240788504561455, 0.01092072816276678, 1.1733567298156962},
{-2.0700185348814393, -0.993782104076519, -0.06436642989351278, -2.2130519119614265, 0.0014500454434524335, 1.1857714637397245},
{-2.0693240254898875, -0.9700084768807877, -0.07528122080952065, -2.2013284395894313, -0.007553504409858141, 1.1978197962222097},
{-2.0685575282242694, -0.9459887674011975, -0.0861523950212465, -2.188909130581129, -0.016085775347353844, 1.209488920272924},
{-2.067715044804359, -0.9217305665606855, -0.09698260601951673, -2.175794422193197, -0.024142337539692277, 1.220766511883115},
{-2.0667939343943553, -0.8972404030394056, -0.1077753325185632, -2.1619843956510434, -0.03171839849475759, 1.2316407270923593},
{-2.0657929246237403, -0.8725236161076754, -0.11853480452117068, -2.147478674111843, -0.0388087207460367, 1.2421001828392249},
{-2.0647121251650606, -0.8475842343913478, -0.12926593130148503, -2.132276314203754, -0.045407535739929034, 1.2521339214356106},
{-2.0635530469116463, -0.8224248598618333, -0.13997423115317542, -2.1163756905162674, -0.05150845340863614, 1.2617313586011278},
{-2.0623186298796274, -0.7970465560119644, -0.15066576245998783, -2.099774372191807, -0.05710436668253984, 1.270882215036054},
{-2.061013283073678, -0.7714487388805479, -0.16134705533113403, -2.0824689904896894, -0.0621873500289295, 1.2795764314586016},
{-2.0596429397515035, -0.7456290693214517, -0.17202504265653484, -2.0644550958584067, -0.06674855108201835, 1.2878040668892181},
{-2.0582151317071284, -0.7195833446988131, -0.18270698912713298, -2.0457270026555716, -0.07077807422490648, 1.2955551797577398},
{-2.0567390865334647, -0.69330538799279, -0.19340041629708643, -2.026277619173829, -0.07426485504426693, 1.302819691095786},
{-2.055225852206765, -0.6667869321461787, -0.20411302131332465, -2.00609826005426, -0.0771965245170036, 1.3095872286905477},
{-2.053688453851473, -0.6400174973505363, -0.21485258637103757, -1.9851784374642645, -0.07955926183254725, 1.3158469505889097},
{-2.052142088191184, -0.6129842588657579, -0.2256268752613294, -1.9635056265557733, -0.08133763490419499, 1.3215873457573495},
{-2.0506043619525434, -0.585671902888557, -0.23644351259005025, -1.9410649996464973, -0.08251442775663172, 1.3267960090043855},
{-2.049095581423716, -0.5580624679301696, -0.24730984023298766, -1.9178391222307123, -0.0830704543669434, 1.331459386454059},
{-2.047639101412893, -0.5301351691335968, -0.2582327444380375, -1.8938076022264265, -0.08298435895303728, 1.3355624868882447},
{-2.0462617430471117, -0.5018662029509212, -0.26921844555790986, -1.8689466816997227, -0.08223240344713814, 1.339088553142896},
{-2.0449942911241497, -0.47322852959799155, -0.2802722407586575, -1.8432287574987738, -0.08078824383199819, 1.3420186864008725},
{-2.0438720830493438, -0.44419163067818307, -0.2913981881396762, -1.816621813564029, -0.07862269837883157, 1.344331414645862},
{-2.042935702635387, -0.41472123924786536, -0.30259871859655657, -1.7890887428254425, -0.0757035125807748, 1.3460021946593614},
{-2.0422317930993823, -0.38477903923797, -0.31387415952802183, -1.760586530083666, -0.07199512779350938, 1.3470028346698686},
{-2.041814004257282, -0.35432233028547927, -0.32522215230472773, -1.7310652584220045, -0.06745846333238785, 1.3473008219828793},
{-2.041744088994283, -0.3233036521443292, -0.3366369436251908, -1.7004668894477755, -0.062050724714080054, 1.3468585363639247},
{-2.042093163420783, -0.2916703590471268, -0.34810852992473934, -1.668723750444435, -0.055725253596823385, 1.34563232523552},
{-2.0429431437449685, -0.2593641270894456, -0.35962163460499424, -1.6357566368110545, -0.04843143673508956, 1.3435714101023593},
{-2.044388371423081, -0.22632036417374995, -0.37115450092896207, -1.6014724019065418, -0.04011468999510803, 1.3406165835666257},
{-2.0465374384264887, -0.19246746771821954, -0.3826774899025406, -1.5657608519572854, -0.03071652609894426, 1.3366986402202865},
{-2.0495152308916897, -0.15772583250073008, -0.39415148301272507, -1.5284906796292195, -0.02017469542723733, 1.3317364575208543},
{-2.053465231234307, -0.12200643690150156, -0.4055261036420717, -1.4895040364031449, -0.008423348835382158, 1.3256345952004507},
{-2.0585521742131054, -0.08520870892595062, -0.41673778459409944, -1.448609125248673, 0.0046069048470599155, 1.3182801964670252},
{-2.0498668816178873, -0.11435315751795821, -0.40367778700053397, -1.4795829120277644, -0.004873173574931274, 1.322868120640733},
{-2.0420953912634774, -0.1424602815520836, -0.3903409597360957, -1.5091135640188507, -0.013180252146466478, 1.3266795491591379},
{-2.035111930272668, -0.16958333972801068, -0.3767892315424682, -1.5373110615491734, -0.02036062648738658, 1.3297953614681912},
{-2.0288041001677506, -0.1957716513723753, -0.3630735681012526, -1.56426849213355, -0.02646184167924334, 1.3322869927579795},
{-2.023071980480861, -0.22107099799878682, -0.3492351428057333, -1.5900654007731525, -0.031531857838553855, 1.3342178845110155},
{-2.0178272184455674, -0.24552369771159133, -0.33530664072985006, -1.6147701497712639, -0.03561818352739405, 1.3356445301217021},
{-2.0129920484120403, -0.26916864787375405, -0.32131350534344555, -1.6384417829891886, -0.038767213998504704, 1.3366173898888138},
{-2.008498290664092, -0.29204137763353677, -0.3072750866721617, -1.661131518392617, -0.041023762378521296, 1.3371816957994762},
{-2.0042863707922316, -0.3141741269649658, -0.2932056689575636, -1.6828839566546343, -0.04243075760349884, 1.3373781591311182},
{-2.0003043892848726, -0.33559595528793856, -0.27911537051582386, -1.7037380694598512, -0.04302907813650859, 1.337243590663672},
{-1.9965072600295173, -0.3563328761151107, -0.2650109184277041, -1.7237280146297522, -0.042857491195794406, 1.3368114419752681},
{-1.9928559274094693, -0.37640801159697335, -0.25089630672110136, -1.742883813582896, -0.041952670622882056, 1.3361122757059944},
{-1.9893166649744207, -0.39584176044704283, -0.23677334981155795, -1.7612319183068803, -0.0403492709693486, 1.3351741722806887},
{-1.985860454043122, -0.4146519733901539, -0.222642144103277, -1.7787956888951804, -0.03808003978783345, 1.3340230801477886},
{-1.982462437682008, -0.4328541313538052, -0.20850145049012522, -1.795595798142608, -0.035175954204926106, 1.3326831161037116},
{-1.9791014438587542, -0.4504615227527267, -0.19434900962196175, -1.811650576229545, -0.0316663712654621, 1.3311768217034792},
{-1.9757595708194806, -0.467485417239774, -0.18018180057448616, -1.8269763058675728, -0.027579184280093406, 1.3295253811615892},
{-1.9724218276008902, -0.4839352341453269, -0.1659962521806189, -1.8415874762208635, -0.022940979633236658, 1.3277488055572257},
{-1.9690758228219158, -0.49981870448873883, -0.15178841494304632, -1.8554970023027058, -0.01777719015293625, 1.325866087588621},
{-1.9657114953573804, -0.5151420259379724, -0.13755410019497677, -1.8687164152756235, -0.012112242402692083, 1.3238953306013979},
{-1.9623208810717265, -0.5299100104401026, -0.12328899204878854, -1.8812560280730612, -0.005969696203366735, 1.3218538551447012},
{-1.9588979103938837, -0.5441262244811852, -0.10898873671891188, -1.8931250799591832, 0.0006276246863039243, 1.3197582859051398},
{-1.9554382321415222, -0.5577931220720131, -0.09464901294217891, -1.9043318629937023, 0.007657511244512168, 1.317624621502083},
{-1.951939059572864, -0.5709121706369291, -0.08026558654414054, -1.914883832853699, 0.015098257460509832, 1.3154682893320864},
{-1.9483990351857376, -0.5834839700139456, -0.06583435161298674, -1.9247877060492578, 0.022928558211829767, 1.3133041873986986},
{-1.9448181112876446, -0.5955083647651207, -0.05135136024037979, -1.934049545224487, 0.031127416546773007, 1.3111467148330962},
{-1.9411974437838027, -0.6069845499840352, -0.036812842427489716, -1.9426748339761037, 0.039674060152461436, 1.3090097926592243},
{-1.9375392970523975, -0.6179111707355877, -0.022215217386113546, -1.950668542379998, 0.04854786661655513, 1.3069068761654676},
{-1.933846958095084, -0.6282864152434585, -0.007555097256672569, -1.958035184261694, 0.05772829716892817, 1.3048509601693337},
{-1.9301246584904133, -0.6381081018793772, 0.007170715996078715, -1.964778867073843, 0.06719483844681566, 1.3028545783007903},
{-1.9263775029230903, -0.6473737599904462, 0.021965239874172243, -1.9709033351490863, 0.07692695190326662, 1.300929797386173},
{-1.9226114033192117, -0.6560807045538601, 0.03683132635494845, -1.9764120069791675, 0.08690403039127585, 1.2990882078933572},
{-1.9188330178196433, -0.664226104623699, 0.051771682245762375, -1.981308007090846, 0.09710536145859355, 1.2973409113254057},
{-1.9150496939824986, -0.6718070455414981, 0.06678889456718252, -1.9855941930557566, 0.10751009693772695, 1.2956985054490713},
{-1.9112694158067671, -0.6788205848156812, 0.08188546078655842, -1.98927317804137, 0.11809722823775134, 1.2941710680324758},
{-1.9075007542437634, -0.6852638016366867, 0.09706382369065869, -1.9923473493511101, 0.12884556691190233, 1.2927681398831086},
{-1.9037528210311858, -0.6911338399179492, 0.11232641081847736, -1.9948188832584197, 0.13973372985692964, 1.2914987077130307},
{-1.9000352257179998, -0.6964279448504933, 0.12767567832302176, -1.9966897565268258, 0.1507401286726931, 1.2903711875510027},
{-1.8963580358949055, -0.7011434928499422, 0.1431141592728706, -1.997961754822738, 0.16184296244486354, 1.2893934090573873},
{-1.8927317406559592, -0.7052780148690977, 0.15864451635975776, -1.9986364783132258, 0.1730202133586502, 1.2885726012779872},
{-1.890921587817733, -0.7315102683986379, 0.15238295973970686, -2.0143066265939638, 0.17244973978368652, 1.277325091739654},
{-1.8890956745464202, -0.7575326047286725, 0.14613326921609796, -2.0292421707638058, 0.17157946614087297, 1.2655523744983903},
{-1.8872602151421913, -0.7833427927134041, 0.13989498992541102, -2.0434468232911525, 0.17041999721820197, 1.2532635768399587},
{-1.8854204491301036, -0.8089371323119863, 0.1336677141986505, -2.05692324667542, 0.16898162706857187, 1.2404679395909486},
{-1.8835807129031972, -0.834310568701335, 0.12745113664693827, -2.069673229992533, 0.16727438001661551, 1.2271749088446697},
{-1.8817444952123998, -0.8594567616865487, 0.12124510881431826, -2.0816978066054395, 0.16530803988881587, 1.2133942060172305},
{-1.8799144859722283, -0.8843681574396804, 0.1150496892486801, -2.0929973632038696, 0.16309217718831467, 1.1991358862264765},
{-1.878092619438006, -0.9090360632068015, 0.10886518934514751, -2.1035717411499117, 0.16063617395592839, 1.1844103852138785},
{-1.8762801127679638, -0.9334507254643193, 0.1026922151962341, -2.1134203308747272, 0.1579492461498178, 1.1692285549856727},
{-1.87447750094702, -0.9576014118394729, 0.09653170558154364, -2.1225421598727223, 0.15504046342147046, 1.153601688333477},
{-1.872684669008728, -0.9814764969383822, 0.0903849661391404, -2.130935974671455, 0.15191876618786548, 1.1375415324087095},
{-1.8709008824325069, -1.0050635520480111, 0.08425369966373443, -2.1386003170170347, 0.14859297993969234, 1.1210602915662709},
{-1.869124816533297, -1.0283494385004563, 0.07814003240648265, -2.145533594398467, 0.14507182671836627, 1.104170619757514},
{-1.8673545855783609, -1.0513204043111486, 0.07204653618161956, -2.1517341449423006, 0.1413639337023293, 1.086885602837213},
{-1.865587772267289, -1.0739621835317628, 0.06597624602998081, -2.157200296637231, 0.13747783884607928, 1.069218731248303},
{-1.8638214581053527, -1.0962600976010501, 0.05993267317018666, -2.161930420794239, 0.13342199347406702, 1.0511838636594277},
{-1.862052255055139, -1.1181991578325474, 0.05391981293278264, -2.165922979614932, 0.12920476177593088, 1.0327951822413175},
{-1.8602763387187804, -1.1397641680607364, 0.04794214740969225, -2.1691765677195085, 0.12483441708876201, 1.0140671403824506},
{-1.8584894831349368, -1.160939826373528, 0.04200464257733459, -2.1716899474827462, 0.12031913488583543, 0.9950144037463773},
{-1.856687097107651, -1.181710824796755, 0.036112739711072456, -2.173462078034889, 0.1156669824324871, 0.975651785658686},
{-1.8548642618274787, -1.2020619457728778, 0.030272341036149193, -2.174492137801379, 0.11088590502573788, 0.9559941778865848},
{-1.8530157693750768, -1.221978154278839, 0.02448978963131136, -2.174779540485383, 0.10598370892480492, 0.9360564779042446},
{-1.8511361615695894, -1.2414446844799887, 0.018771843821217868, -2.1743239444267526, 0.10096804096272516, 0.9158535137698302},
{-1.8492197685025646, -1.260447119883206, 0.013125646369072212, -2.17312525531165, 0.09584636516304286, 0.8953999676998372},
{-1.8472607460221535, -1.2789714660676235, 0.007558689043854621, -2.1711836222414167, 0.09062593655567559, 0.8747102994042936},
{-1.8452531114014374, -1.2970042151901664, 0.0020787732327427377, -2.1684994272086633, 0.08531377272255238, 0.8537986701477777},
{-1.8431907764194344, -1.3145324016142137, -0.003306032503725762, -2.1650732680599796, 0.07991662355134838, 0.832678868419109},
{-1.8410675771595124, -1.331543648154706, -0.008587436951990334, -2.1609059350539286, 0.07444093996001665, 0.8113642379516295},
{-1.8388772999043943, -1.348026202590873, -0.0137569717001035, -2.15599838114294, 0.0688928423212528, 0.7898676087139689},
{-1.8366137026778042, -1.363968964236447, -0.018806036365405218, -2.1503516861204846, 0.06327808954221353, 0.7682012313276279},
{-1.8342705321283927, -1.3793615004921231, -0.023725942376106198, -2.1439670147768957, 0.05760204970996544, 0.746376715228866},
{-1.831841535654949, -1.39419405341389, -0.02850795413422664, -2.1368455691985937, 0.05186967329115134, 0.7244049707376147},
{-1.8293204688863072, -1.4084575364176228, -0.03314332647333444, -2.128988535324462, 0.046085469881329603, 0.7022961550527643},
{-1.8267010988053525, -1.4221435213051077, -0.037623337428014304, -2.120397023839184, 0.04025348939579041, 0.6800596220683901},
{-1.8239772030188854, -1.4352442158297356, -0.041939315516360536, -2.111072005434987, 0.034377308566101446, 0.6577038757811576},
{-1.8211425658669802, -1.4477524320274764, -0.04608266094626485, -2.101014240409034, 0.028460023522462415, 0.6352365269525208},
{-1.8181909720981033, -1.4596615455338895, -0.050044860291684694, -2.0902242024842086, 0.02250424892904389, 0.6126642526148232},
{-1.8151161991587912, -1.4709654460484491, -0.05381749456292645, -2.078701996638991, 0.016512124337418305, 0.5899927578969208},
{-1.8119120089829657, -1.481658479070726, -0.05739224064079531, -2.0664472706141277, 0.010485327868618277, 0.5672267396120235},
{-1.8085721404042876, -1.4917353789338428, -0.060760866392309355, -2.0534591196167806, 0.004425097485312221, 0.5443698509553935},
{-1.8050903032508463, -1.501191193068652, -0.0639152199160671, -2.0397359835711186, -0.001667740172349604, 0.5214246666092116},
{-1.7878632018324248, -1.4982602417992494, -0.07673046624003978, -2.0404566103194797, -0.02653326372875313, 0.5263135574277078},
{-1.7707115820807346, -1.4953203562729225, -0.0897038595735713, -2.0405054465995467, -0.05136689323125705, 0.530820737115716},
{-1.7536289616603473, -1.4923727315359083, -0.10280990060037191, -2.0398840195647, -0.076177575452227, 0.5349517846350196},
{-1.7366093670145712, -1.4894181705824767, -0.11602367147889744, -2.038594388182956, -0.1009736547607454, 0.5387129320004161},
{-1.7196473397076055, -1.4864571365450117, -0.12932090321487422, -2.0366391984390573, -0.12576302714678875, 0.5421111040975697},
{-1.7027379505519962, -1.4834897316940672, -0.14267804796284478, -2.034021669953293, -0.15055326876294348, 0.5451539591839315},
{-1.6858768184537012, -1.4805156729043063, -0.15607235482593662, -2.0307455794352225, -0.17535175306177925, 0.5478499284379709},
{-1.669060133565889, -1.4775342633785629, -0.16948194851456877, -2.0268152410594356, -0.20016575580095958, 0.5502082555116912},
{-1.6522846844241408, -1.4745443604654382, -0.1828859104690469, -2.022235483897315, -0.22500254692526706, 0.5522390371585252},
{-1.6355478887712998, -1.4715443393946679, -0.19626436226420846, -2.0170116265401226, -0.2498694681648777, 0.5539532659871453},
{-1.6188478278227998, -1.468532052769988, -0.209598551350004, -2.0111494490386925, -0.2747739949649204, 0.5553628764309368},
{-1.6021832837396197, -1.4655047856442183, -0.22287093940636982, -2.0046551622354722, -0.2997237811529452, 0.5564807949766976},
{-1.5855537800626724, -1.4624592060154755, -0.23606529381488423, -1.9975353744952136, -0.3247266844862563, 0.5573209956870425},
{-1.5689596247979236, -1.4593913105821068, -0.24916678294883277, -1.9897970557263613, -0.3497907709507077, 0.5578985619517839},
{-1.5524019557240316, -1.4562963655880223, -0.2621620761591132, -1.9814474984233033, -0.37492429538115013, 0.5582297552207477},
{-1.5358827872662837, -1.453168842669912, -0.27503944945924397, -1.9724942752741392, -0.4001356556103203, 0.5583320913308962},
{-1.519405057974409, -1.4500023496335246, -0.2877888979782669, -1.962945192601164, -0.42543331702997916, 0.5582244246053196},
{-1.502972677152096, -1.4467895562656743, -0.30040225621410593, -1.9528082386054355, -0.4508257040758866, 0.557927039537121},
{-1.4865905685729364, -1.4435221154236941, -0.31287332697360437, -1.942091524980924, -0.47632105487600007, 0.5574617491170066},
{-1.4702647083448397, -1.4401905799893258, -0.325198019552652, -1.9308032200308185, -0.5019272350959929, 0.556851998080748},
{-1.4540021529147589, -1.4367843166597887, -0.3373744971752806, -1.9189514708866642, -0.5276515070413975, 0.5561229681462783},
{-1.4378110518595106, -1.433291418120825, -0.34940333290005315, -1.9065443118527456, -0.5535002504079618, 0.5553016808344537},
{-1.4217006384557724, -1.42969861596883, -0.36128767203406914, -1.8935895553091697, -0.579478631884542, 0.5544170917127952},
{-1.4056811892139902, -1.425991197625734, -0.37303339759413884, -1.880094660966471, -0.6055902223319262, 0.5535001675379263},
{-1.3897639414568965, -1.4221529318085522, -0.38464929335662856, -1.866066578779465, -0.6318365626759778, 0.552583935372966},
{-1.3739609560171075, -1.4181660084317986, -0.3961471966951217, -1.8515115604379373, -0.6582166832726016, 0.5517034898094731},
{-1.3582849102623737, -1.4140110004447979, -0.40754213066421463, -1.8364349343286435, -0.6847265865108296, 0.5508959416700806},
{-1.342748805482886, -1.4096668566071608, -0.41885240194597473, -1.820840839262237, -0.7113587089979269, 0.5502002889499814},
{-1.327365572561256, -1.4051109356505274, -0.430099648558571, -1.8047319133745676, -0.7381013877412979, 0.5496571891983738},
{-1.3121475616050866, -1.4003190930279636, -0.4413088192793995, -1.7881089365084306, -0.764938363989671, 0.5493086123659462},
{-1.2971059053791656, -1.3952658314200754, -0.45250806613058586, -1.770970427302015, -0.7918483679625673, 0.5491973556769868},
{-1.282249753706365, -1.3899245245173417, -0.4637285329996707, -1.7533122000166785, -0.8188048362630996, 0.549366407816731},
{-1.2675853866588132, -1.3842677201264142, -0.47500402826734894, -1.7351268906889912, -0.8457758193197227, 0.54985815976989},
{-1.2531152281245979, -1.378267522775786, -0.48637057793161625, -1.7164034668536954, -0.8727241364151802, 0.55071347394427},
{-1.2388367969116503, -1.3718960478650064, -0.49786586821228956, -1.6971267390045097, -0.8996078283143505, 0.5519706413320704},
{-1.224741647707151, -1.3651259293887943, -0.5095286023185889, -1.6772768939017373, -0.9263809405705965, 0.5536642764194528},
{-1.2108143656723611, -1.3579308525985176, -0.5213978131523496, -1.6568290685238973, -0.9529946441117675, 0.5558242183870634},
{-1.1970316825888987, -1.3502860732846835, -0.5335121894718867, -1.6357529777944149, -0.9793986659355863, 0.5584745207597703},
{-1.1833617760718949, -1.3421688787962036, -0.5459094841516445, -1.614012598721493, -1.0055429663678184, 0.5616326161228277},
{-1.1697637948906037, -1.333558944169703, -0.5586260767562639, -1.5915658986639587, -1.0313795672450525, 0.5653087347837051},
{-1.1561876237223616, -1.3244385409212995, -0.5716967571132701, -1.5683645774158488, -1.056864414748747, 0.569505635893072},
{-1.1695950872390586, -1.3362334730691026, -0.5587622525518973, -1.5956065029295607, -1.030475960294135, 0.5663172053020891},
{-1.1829932367366642, -1.347442703732837, -0.5462736150488757, -1.6220385144790632, -1.0037569188285478, 0.5637362682407574},
{-1.1964427567204987, -1.3580882806871366, -0.5341835119508599, -1.647723516637627, -0.9767574334475084, 0.56176116088938},
{-1.209992204524582, -1.3681948997431825, -0.5224432479601975, -1.6727156532290721, -0.9495319339223341, 0.5603810938941026},
{-1.2236785181249668, -1.3777897726864534, -0.5110029043952887, -1.697060922526648, -0.9221366215832261, 0.5595765567500445},
{-1.237527792622528, -1.386902255226212, -0.49981180485462284, -1.720797696316334, -0.8946270880784817, 0.5593201099739987},
{-1.251556333742785, -1.3955633291647735, -0.48881919463967505, -1.7439572767578833, -0.8670562029094829, 0.5595775072689627},
{-1.2657719268336487, -1.403805003238114, -0.47797502818414955, -1.7665645074579606, -0.8394723909208837, 0.5603090323825128},
{-1.2801752330700054, -1.4116596945434927, -0.46723076688971743, -1.7886384326108382, -0.8119183696956347, 0.5614709262360424},
{-1.2947612174724035, -1.419159642598168, -0.45654010896099684, -1.810192983647869, -0.7844303621499297, 0.5630167897248811},
{-1.3095205225723165, -1.4263363937872424, -0.4458595980354235, -1.8312376665516605, -0.7570377522044458, 0.5648988710677982},
{-1.3244407212859772, -1.4332203784603783, -0.435149083278819, -1.8517782233922973, -0.7297631178894036, 0.5670691766664913},
{-1.339507406532927, -1.439840588847634, -0.42437202599782664, -1.871817246475807, -0.702622558601857, 0.5694803745637508},
{-1.3547050981943336, -1.4462243549647058, -0.41349566434609336, -1.8913547304595912, -0.675626229748543, 0.5720864852154406},
{-1.3700179669459795, -1.452397208276294, -0.40249105785571915, -1.910388554985307, -0.648779004897193, 0.5748433730522108},
{-1.3854303879010466, -1.4583828189718449, -0.39133303798206565, -1.9289148966360707, -0.6220811985475195, 0.5777090640094389},
{-1.400927345082946, -1.4642029913534418, -0.3800000911169116, -1.9469285736682902, -0.595529297929697, 0.5806439195522517},
{-1.4164947111984196, -1.4698777025780745, -0.3684741979285685, -1.9644233300561615, -0.5691166672405233, 0.5836106986587329},
{-1.4321194274687654, -1.4754251716557767, -0.3567406489567077, -1.9813920669544487, -0.5428342007501819, 0.5865745369242623},
{-1.44778960640263, -1.4808619478793343, -0.34478785194986467, -1.9978270301871786, -0.5166709116404621, 0.5895028681167449},
{-1.463494577389278, -1.4862030102204784, -0.3326071421761569, -2.0137199621077033, -0.49061445118301916, 0.5923653090527231},
{-1.479224891649853, -1.4914618713145666, -0.3201926032616336, -2.0290622254102444, -0.46465155817278586, 0.59513352414207},
{-1.4949722996888248, -1.4966506815738838, -0.3075409030346764, -2.043844905527632, -0.43876844192988107, 0.597781081995391},
{-1.5107297113693765, -1.501780330445891, -0.29465114650389745, -2.0580588971932285, -0.4129511040542659, 0.6002833130334626},
{-1.5264911461441688, -1.5068605429794186, -0.28152474634962393, -2.071694979721346, -0.3871856049255258, 0.6026171742257055},
{-1.5422516787620515, -1.511899970792788, -0.2681653100328858, -2.0847438846536335, -0.36145828106358746, 0.6047611249703749},
{-1.5580073841140956, -1.5169062770704225, -0.25457854182791034, -2.0971963585688878, -0.33575591909125174, 0.6066950163668006},
{-1.5737552834578292, -1.5218862157154451, -0.24077215752006048, -2.109043223185584, -0.3100658914783806, 0.6083999950051219},
{-1.589493293298928, -1.5268457049604172, -0.22675580926023725, -2.1202754342685277, -0.2843762585196917, 0.6098584214207035},
{-1.6052201774182038, -1.5317898959032958, -0.21254101793661265, -2.1308841403760588, -0.2586758402938687, 0.6110538027854633},
{-1.6209355019850322, -1.5367232364740078, -0.19814111043867516, -2.1408607420837913, -0.2329542616740209, 0.6119707389995224},
{-1.636639593346977, -1.541649531285058, -0.18357115930260554, -2.150196951986817, -0.2072019728533872, 0.6125948810537786},
{-1.6523334978438378, -1.546571997754792, -0.16884792239400814, -2.1588848555236297, -0.18141024734691316, 0.6129129003953081},
{-1.6680189428779455, -1.5514933187827764, -0.15398978050645523, -2.1669169724543638, -0.15557115902211824, 0.6129124679468477},
{-1.6836982984237276, -1.5564156921625476, -0.1390166710073784, -2.1742863186724612, -0.1296775394036321, 0.6125822414567956},
{-1.6993745382558123, -1.56134087672279, -0.12395001596501144, -2.180986467878757, -0.10372291628276091, 0.6119118597524977},
{-1.7150512001717892, -1.5662702352089808, -0.10881264346928561, -2.18701161261089, -0.07770143452781153, 0.6108919427468154},
{-1.7307323447346121, -1.5712047736690244, -0.0936287012135502, -2.1923566240090318, -0.0516077599378795, 0.6095140958504044},
{-1.7464225121316383, -1.5761451771613206, -0.07842356171083045, -2.1970171097237454, -0.02543696697581203, 0.6077709177413841},
{-1.7621266769660382, -1.5810918415066768, -0.06322371886650319, -2.2009894693570673, 0.0008155887417442177, 0.605656010441407},
{-1.7778502009635209, -1.5860449007891841, -0.0480566759527314, -2.2042709468586406, 0.027154412235492302, 0.6031639907296653},
{-1.7935987837186267, -1.59100425037732, -0.03295082534947273, -2.206859679378054, 0.053584024206261, 0.600290502125782},
{-1.8093784117478295, -1.5959695652533248, -0.017935320711155653, -2.2087547421482054, 0.08010912820363716, 0.5970322267284095},
{-1.8251953061895425, -1.6009403135220328, -0.0030399424736596422, -2.209956189090278, 0.10673478872119854, 0.5933868963494422},
{-1.8410558695194452, -1.6059157650840825, 0.011705042162988715, -2.210465088978321, 0.13346661899275458, 0.5893533025890195},
{-1.8569666316067701, -1.610894995540688, 0.026269023492267715, -2.2102835571555213, 0.16031097724600998, 0.5849313056485993},
{-1.8729341953196526, -1.615876885514363, 0.040621196428093524, -2.2094147829877446, 0.18727517022580492, 0.5801218419446293},
{-1.888965181693029, -1.620860115664329, 0.054730709128039914, -2.2078630534516375, 0.2143676629049639, 0.5749269308737683},
{-1.905066174353705, -1.6258431577129302, 0.06856681186920774, -2.2056337734711984, 0.24159829341261926, 0.5693496813668703},
{-1.921243662543415, -1.6308242618840467, 0.08209900512082328, -2.2027334838911634, 0.26897849246909633, 0.5633942993759707},
{-1.9375039815600574, -1.635801441109137, 0.09529718614158877, -2.1991698782273854, 0.2965215068101361, 0.5570660978621753},
{-1.953853248823044, -1.6407724523052496, 0.10813179394497086, -2.194951819623044, 0.32424262634215006, 0.5503715114692896},
{-1.9702972930698952, -1.6457347749514053, 0.12057395313282027, -2.1900893597595243, 0.35215941507591947, 0.5433181188448593},
{-1.9868415732404954, -1.6506855869698185, 0.13259561804709186, -2.1845937617643796, 0.3802919460259199, 0.5359146763788163},
{-2.003491082565132, -1.6556217377208966, 0.14416971980318713, -2.178477529508481, 0.4086630404357545, 0.5281711682719091},
{-2.0202502320339604, -1.6605397176019356, 0.155270320235016, -2.1717544460184337, 0.4372985116210153, 0.5200988791576042},
{-2.037122705782057, -1.6654356233515764, 0.1658727786207912, -2.1644396240716257, 0.4662274133893724, 0.5117104971590821},
{-2.0541112788582563, -1.6703051176742167, 0.1759539393904334, -2.1565495723668446, 0.4954822922255603, 0.5030202573414326},
{-2.071217585278307, -1.6751433812230947, 0.18549235193602415, -2.1481022809667394, 0.5250994410567221, 0.49404413817720294},
{-2.088441820932952, -1.6799450542186158, 0.19446853742476564, -2.1391173299047614, 0.5551191500019391, 0.48480012697997577},
{-2.105782361707213, -1.6847041640361784, 0.2028653223246963, -2.1296160248817158, 0.5855859456749647, 0.4753085745410472},
{-2.123235271844109, -1.689414033908469, 0.21066826449044096, -2.1196215637011426, 0.6165488046596966, 0.46559266465204024},
{-2.1407936708561017, -1.6940671663124627, 0.21786620553300104, -2.1091592362291314, 0.6480613175986204, 0.45567903102498447},
{-2.1584469190741715, -1.6986550925912558, 0.22445199309831518, -2.0982566588325984, 0.6801817665413629, 0.44559856257471714},
{-2.176179572220725, -1.7031681777176764, 0.23042342892276052, -2.0869440407515785, 0.7129730575932542, 0.4353874480967108},
{-2.1939700447908375, -1.7075953657253988, 0.23578451302639541, -2.0752544736348955, 0.7465024205798866, 0.4250885226483072},
{-2.2117889121088155, -1.7119238471004041, 0.240547070318628, -2.0632242248209, 0.7808407434565584, 0.41475298901533425},
{-2.2295967753995596, -1.7161386244276078, 0.24473286063610153, -2.0508929973528667, 0.8160613468490434, 0.4044425951920329},
{-2.24734162061213, -1.7202219473285427, 0.24837628082909993, -2.0383040915791115, 0.8522379188026207, 0.3942323458417046},
{-2.264955634279464, -1.724152583654019, 0.25152775570349256, -2.0255043598475932, 0.8894412197192471, 0.3842137988304649},
{-2.2823515233034044, -1.7279048943446043, 0.2542578604762452, -2.0125437824052548, 0.9277340399597654, 0.37449892326809353},
{-2.2994185599029673, -1.7314476910643257, 0.2566620819010461, -1.9994744069641968, 0.9671637774071519, 0.36522433424787304},
{-2.3160188925945393, -1.7347428908409646, 0.2588658499292967, -1.9863482942348085, 1.0077519750951238, 0.35655541685106046},
{-2.3319851827373776, -1.7377440594542573, 0.2610289878988912, -1.973214029024086, 1.0494803740045544, 0.34868935007356044},
};

double time_array[] = {0.0, 0.14749546, 0.289963665, 0.427381736, 0.559859804, 0.687593127, 0.810826187, 0.929827275, 1.044871292, 1.156228584, 1.264158012, 1.368902911, 1.470688963, 1.569723314, 1.6661944690000001, 1.760272668, 1.852110546, 1.941843937, 2.029592762, 2.115461942, 2.199542313, 2.281911537, 2.362634994, 2.441766669, 2.51935002, 2.595418849, 2.669998163, 2.743105027, 2.815028753, 2.888836028, 2.964528941, 3.042106225, 3.121562946, 3.20289023, 3.28607505, 3.371100083, 3.457943637, 3.5465796640000002, 3.636977867, 3.729103884, 3.822919577, 3.918383396, 4.015450828, 4.114074922, 4.214206864, 4.315796618, 4.418793593, 4.523147339, 4.62880826, 4.735728326, 4.843861775, 4.953165808, 5.063601254, 5.175133212, 5.287731665, 5.401372064, 5.516035888, 5.631711174, 5.74839303, 5.866084144, 5.984795268, 6.104545726, 6.225363918, 6.347287853, 6.470365714, 6.594656465, 6.720230516, 6.847170447, 6.975571821, 7.105544079, 7.237211543, 7.370714526, 7.506210579, 7.643875866, 7.783906712, 7.926521324, 8.072466791, 8.224039727, 8.381668393, 8.545859427, 8.717216540999999, 8.896465476, 9.104488056, 9.273490696, 9.409263808, 9.538907475, 9.662849685, 9.781456161, 9.895041214, 10.003876309, 10.109038285, 10.210798052, 10.309289217, 10.404631382, 10.496930855, 10.586281425, 10.672765162, 10.756453245, 10.837406769, 10.915677548, 10.991308889999999, 11.06433634, 11.134788392, 11.203846992, 11.272784902, 11.341638252, 11.410440746, 11.479223658, 11.548015847, 11.616843791, 11.685731628, 11.75470122, 11.823772216, 11.892962142, 11.962286486, 12.031758813, 12.101390872, 12.171192734, 12.24117292, 12.311345735, 12.381917080000001, 12.452898601, 12.528695323, 12.659303385, 12.778946311, 12.897613842, 13.015288966, 13.131948444, 13.247563124, 13.362098277, 13.475513936, 13.587765257000001, 13.698802895, 13.808573401, 13.917019632, 14.024081179, 14.129694815, 14.233794949, 14.336314094, 14.437183337, 14.536332809, 14.633692157, 14.729191001, 14.822759373, 14.914328148, 15.003829436, 15.091196955, 15.176366363, 15.259275554, 15.340194335, 15.421859586, 15.50422215, 15.58723509, 15.670853926, 15.755036855, 15.839744961, 15.924942405, 16.010596606, 16.096678402, 16.183162212, 16.270026176000002, 16.3572523, 16.444826586, 16.532739169, 16.628009375, 16.72315738, 16.818217465, 16.913221601, 17.008200039, 17.103181808, 17.198195157, 17.293267965, 17.388428084, 17.483703644, 17.579123287, 17.674716338, 17.770512902, 17.866543885, 17.962840913, 18.059436163, 18.156362069, 18.253650908, 18.351334245, 18.449442215, 18.548002644, 18.647039975, 18.746574004, 18.846618411, 18.947179102, 19.048252361, 19.149822872, 19.251861655, 19.354324026, 19.45714769, 19.560251153, 19.663532641, 19.766869741, 19.870119998, 19.973122649, 20.075701623, 20.177669836, 20.27883467, 20.379004404, 20.482207622, 20.598880364, 20.738228813, 20.859755303, 20.977847267, 21.092753642, 21.204685915, 21.313820507, 21.420301337, 21.52598644, 21.631557403, 21.736875439, 21.841827968, 21.946328482, 22.0503153, 22.15374951, 22.25661244, 22.358902886, 22.460634306, 22.561832125, 22.66253123, 22.762773717, 22.862606899, 22.962081585, 23.061250613, 23.160167616, 23.258886003, 23.357458125, 23.455934608, 23.554363833, 23.652791545, 23.75126058, 23.849810689999998, 23.948478463, 24.047297335, 24.146297673, 24.245506944, 24.344949945, 24.444649108, 24.544624873, 24.64489611, 24.745480614999998, 24.846395648, 24.947658529, 25.04928728, 25.151301305, 25.25372211, 25.356574058, 25.459885142, 25.563687796, 25.668019713, 25.772924691, 25.878453481, 25.984664667, 26.091625544, 26.199413018, 26.30811453, 26.417828979, 26.528667683, 26.640755341, 26.754231007, 26.869249049, 26.985980067, 27.104611711, 27.225349308, 27.348416162, 27.474053293, 27.602518285, 27.73408274, 27.869027581, 28.007635136, 28.150176519, 28.296892306, 28.447964097, 28.603474433, 28.763353356};

template <typename T>
double calc_distance(Eigen::Matrix<T, 6, 1> current, double* goal){
    double total_distance = 0;
    for(int i = 0; i < 6; i++){
        total_distance += pow(current[i] - goal[i], 2);
    }
    total_distance = sqrt(total_distance);
    return total_distance;
}

void initialize_output_file(){
    // create INT_BITS_FRAC_BITS directory if it doesn't exist
    std::string which_dir = EXPERIMENT_DIRECTORY + std::to_string(INT_BITS_GRAVITY) + "_" + std::to_string(FRAC_BITS_GRAVITY) + "_" + std::to_string(INT_BITS_FD) + "_" + std::to_string(FRAC_BITS_FD) + "/";
    std::filesystem::create_directory(which_dir);
    DATA_FILE.open(which_dir + "data.csv");
    DATA_FILE << "time,q_1,q_2,q_3,q_4,q_5,q_6,qdot_1,qdot_2,qdot_3,qdot_4,qdot_5,qdot_6,u_1,u_2,u_3,u_4,u_5,u_6,\n";
    // also create a file for configs and other info
    std::ofstream config_file;
    config_file.open(which_dir + "config.txt");
    if(OVERFLOW_MODE == OverflowMode::CLAMP){
        config_file << "OVERFLOW_MODE: CLAMP\n";
    } else {
        config_file << "OVERFLOW_MODE: MASK\n";
    }
    config_file << "TORQUE_HARD_LIMIT: " << TORQUE_HARD_LIMIT << "\n";
    config_file << "TIME_STEP: " << TIME_STEP << "\n";
    
}

void stop_sim_if_needed(double time){
    if(time > TrajectoryVars.EXP_HARD_STOP_TIME){
        exit(0);
    }
}

template <typename T>
void save_position(
    Eigen::Matrix<T, 6, 1> curr_position, 
    Eigen::Matrix<T, 6, 1> curr_vel, 
    Eigen::Matrix<T, 6, 1> u, 
    double time){
    if(TrajectoryVars.went_to_init == false) return;
    DATA_FILE << time << ", ";
    for(int i = 0; i < 6; i++){
        DATA_FILE << curr_position[i] << ", ";
    }
    for(int i = 0; i < 6; i++){
        DATA_FILE << curr_vel[i] << ", ";
    }
    for(int i = 0; i < 6; i++){
        DATA_FILE << u[i] << ", ";
    }
    DATA_FILE << "\n";
    return;
}

template <typename T>
void calculate_goal(
    Eigen::Matrix<T, 6, 1> curr_position, 
    Eigen::Matrix<T, 6, 1> curr_velocity, 
    double* goal, 
    double traj_time, 
    double sim_time){
    if(TrajectoryVars.went_to_init == false){
        if(calc_distance(curr_position, position_array[0]) < TrajectoryVars.GOAL_TOLERANCE){
            TrajectoryVars.went_to_init = true;
            TrajectoryVars.traj_start_time = sim_time;
        }
        for(int i = 0; i < 6; i++){
            goal[i] = position_array[0][i];
        }
        return;
    }
    // check if we are at the end of the trajectory
    if(TrajectoryVars.traj_index == sizeof(time_array)/sizeof(time_array[0])){
        for(int i = 0; i < 6; i++){
            goal[i] = position_array[TrajectoryVars.traj_index - 1][i];
        }
        return;
    }
    // check if we already passed the current index
    double curr_index_time = time_array[TrajectoryVars.traj_index - 1];
    if(traj_time > curr_index_time){
        TrajectoryVars.traj_index++;
        return calculate_goal(curr_position, curr_velocity, goal, traj_time, sim_time);
    }

    double next_index_time = time_array[TrajectoryVars.traj_index];
    double time_diff = next_index_time - curr_index_time;
    double time_ratio = (traj_time - curr_index_time) / time_diff;

    for(int i = 0; i < 6; i++){
        double position_diff = position_array[TrajectoryVars.traj_index][i] - position_array[TrajectoryVars.traj_index - 1][i];
        goal[i] = position_array[TrajectoryVars.traj_index - 1][i] + position_diff * time_ratio;
    }
}

